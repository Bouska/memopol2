{% extends "base.html" %}
{% load recursedict %}


{% block sidebar %}
<li><a href="raw">View Raw JSON</a></li>
{% endblock %}

{% block content %}
<h1>{{d.infos.name.first}} {{d.infos.name.last}}</h1>




<hr/>

Email:
{% if d.contact.email.text %}
    {{ d.contact.email.text }}
{% else %}
    {{ d.contact.email }}
{% endif %}



<hr/>
Complete details:<br/>

{% recursedict d %}
<ul class="treelist">
{% loop %}
<li>{% if key %}<b>{{ key }}</b>:&nbsp;{% endif %}{% value %}</li>
{% endloop %}
</ul>
{% endrecursedict %}


<hr/>



<div id="positions">
<a name="pos"><h2>Prises de position</h2></a>


<ul>
{% for pos in positions %}
    {% if pos.visible %}
        <li>{{ pos.content }}</li>
    {% endif %}
{% endfor %}
</ul>

<p id="positionsnote">
{% ifequal visible_count 0 %}
{% ifnotequal positions|length visible_count %}
Des prises de position sont en attente de mod&eacute;ration.
{% else %}
Aucune prise de position enregistr&eacute;e pour l'instant, mais vous pouvez contribuer en en ajoutant une !
{% endifnotequal %}
{% endifequal %}
</p>



<script type="text/javascript">

function addPositionSubmitButtonClicked()
{
    var contents = jQuery("#text").val();
    if (contents.length == 0)
    {
        msg("La zone de saisie est vide, veuillez entrer du texte...", 1, "red");
        return;
    }

    var btn = jQuery(this);
    startSpinner(btn);
    disable("#addPositionCancelButton");

    ajax_addPosition("{{mep_id}}", contents, function(json) {

        stopSpinner(btn);
        enable("#addPositionCancelButton");

        if (json['success'])
        {
            changeVisibility({addPosition: false, addPositionButton: true});
            jQuery("#text").val("");
            msg("Votre contribution a bien &eacute;t&eacute; prise en compte", 1);
        }
        else
        {
            msg("Une erreur a eu lieu, votre contribution n'a pas &eacute;t&eacute; enregistr&eacute;e", 0, "red");
        }
    });
}

</script>


<div id="addPosition" class="uiform" style="display: none" tabindex="1">
    <h2>Ajout d'une prise de position</h2><hr/>
    <p>Ce formulaire vout permet d'ajouter une prise de position de ce d&eacute;put&eacute;. Votre ajout ne sera affich&eacute; publiquement sur le site qu'apr&egrave;s mod&eacute;ration.</p>
    <br/>
    <textarea rows="5" cols="80" name="text" id="text"></textarea>
    <br/>
    <button id="addPositionSubmitButton" class="submit">Ajouter</button>
    <button id="addPositionCancelButton" class="cancel">Abandonner</button>
</div>

<button id="addPositionButton" class="btn submit">Ajouter une prise de position</button>
</div>

<hr/>



{% endblock %}
{% block documentReady %}

    onClickChangeVisibility("addPositionButton", {addPosition: true, addPositionButton: false});
    onClickChangeVisibility("addPositionCancelButton", {addPosition: false, addPositionButton: true});
    jQuery("#addPositionSubmitButton").click(addPositionSubmitButtonClicked);



{% endblock %}
