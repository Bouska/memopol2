{% extends "base.html" %}
{% load recursedict %}


{% block sidebar %}
<li><a href="/mep/">Back to list</a></li>
<li><a href="raw">View Raw JSON</a></li>
{% endblock %}

{% block content %}
<h1>{{d.infos.name.first}} {{d.infos.name.last}}</h1>




<hr/>

Email:
{% if d.contact.email.text %}
    {{ d.contact.email.text }}
{% else %}
    {{ d.contact.email }}
{% endif %}



<hr/>
Complete details:<br/>

{% recursedict d %}
<ul class="treelist">
{% loop %}
<li>{% if key %}<b>{{ key }}</b>:&nbsp;{% endif %}{% value %}</li>
{% endloop %}
</ul>
{% endrecursedict %}


<hr/>


{{ message }}

<a name="pos">Prises de position</a>

{% if positions %}

Positions:<br/>

<ul id="positions">
{% for pos in positions %}
        <li>{{ pos.content }}
        {% if not pos.visible %}
        (not visible)
        {% endif %}
        {% if not pos.moderated %}
        (not moderated)
        {% endif %}
        </li>
{% endfor %}

</ul>

<hr/>
{% else %}

Aucune prise de position enregistr&acute;e pour l'instant, mais vous pouvez contribuer en en ajoutant une !

{% endif %}



<script>

  function addPositionSubmitButtonClicked()
  {
    changeVisibility({addPosition: false, addPositionButton: true});

    var contents = jQuery("#text").val();

    jQuery.getJSON("/mep/{{ mep_id }}/addposition/", { text: contents }, function(json){

      if (json['success'])
      {
        jQuery("#positions").append('<li>' + contents + '</li>');
      }
    });
  }

</script>


<div id="addPosition" style="display: none" tabindex="1">
    <h2>Ajout d'une prise de position</h2>
    <p>Ce formulaire vout permet d'ajouter une prise de position de ce d&eacute;put&eacute;.<br/>
    NB: Votre ajout ne sera affich&eacute; publiquement sur le site qu'apr&egrave;s mod&eacute;ration.</p>
    <form id="addPositionForm" action="/mep/{{ mep_id }}/addposition/" method="post">
      <textarea rows="5" cols="80" name="text" id="text"></textarea>
      <br/>
      <input id="addPositionCancelButton" type="button" value="Abandonner" />
      <input id="addPositionSubmitButton" type="button" value="Ajouter" />
    </form>
</div>

<span id="addPositionButton" class="clickable">Ajouter une prise de position</span>


{% endblock %}
{% block documentReady %}
    onClickChangeVisibility("addPositionButton", {addPosition: true, addPositionButton: false});
    onClickChangeVisibility("addPositionCancelButton", {addPosition: false, addPositionButton: true});

    jQuery("#addPositionSubmitButton").click(addPositionSubmitButtonClicked);

{% endblock %}
